const { MongoClient, ServerApiVersion } = require('mongodb');
require('dotenv').config();

// MongoDB Atlas connection string
const uri = process.env.MONGODB_URI || "mongodb+srv://1nt22cs211vaibhav:cuF0d97VrNwkpXQu@cluster0.bktaqdx.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0";
const databaseName = 'sakha_app';

async function addMoreThreatLocations() {
  const client = new MongoClient(uri, {
    serverApi: {
      version: ServerApiVersion.v1,
      strict: true,
      deprecationErrors: true,
    }
  });

  try {
    await client.connect();
    console.log("Connected to MongoDB Atlas");
    
    const db = client.db(databaseName);
    const collection = db.collection('threat_locations');
    
    // Sample threat locations across Bangalore
    const threats = [
      {
        name: "Dimly Lit Subway",
        description: "Subway passage with poor lighting and few pedestrians in evening hours",
        latitude: 12.9698,
        longitude: 77.5900,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-04-10"),
        verified: true,
        votes: 18,
        reportCount: 6,
        lastReportDate: new Date("2023-04-20"),
        category: "poorLighting",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Isolated Parking Lot",
        description: "Shopping mall parking area with minimal security after hours",
        latitude: 12.9750,
        longitude: 77.6100,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-04-12"),
        verified: true,
        votes: 12,
        reportCount: 4,
        lastReportDate: new Date("2023-04-22"),
        category: "isolation",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Secluded Bus Stop",
        description: "Poorly lit bus stop with reported incidents",
        latitude: 12.9800,
        longitude: 77.5800,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-04-15"),
        verified: true,
        votes: 25,
        reportCount: 8,
        lastReportDate: new Date("2023-04-25"),
        category: "harassment",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Narrow Alleyway",
        description: "Narrow passage between buildings with poor visibility",
        latitude: 12.9600,
        longitude: 77.6000,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-04-18"),
        verified: true,
        votes: 9,
        reportCount: 3,
        lastReportDate: new Date("2023-04-28"),
        category: "poorLighting",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Crowded Market Corner",
        description: "Area known for pickpocketing and bag snatching",
        latitude: 12.9730,
        longitude: 77.6050,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-04-20"),
        verified: true,
        votes: 15,
        reportCount: 7,
        lastReportDate: new Date("2023-04-30"),
        category: "theft",
        timeOfDay: ["afternoon", "evening"],
        isActive: true
      },
      {
        name: "Construction Site",
        description: "Poorly secured construction area with reported incidents",
        latitude: 12.9650,
        longitude: 77.5950,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-04-22"),
        verified: true,
        votes: 6,
        reportCount: 2,
        lastReportDate: new Date("2023-05-02"),
        category: "other",
        timeOfDay: ["allDay"],
        isActive: true
      },
      {
        name: "Unlit Pathway",
        description: "Path through park with no lighting fixtures",
        latitude: 12.9720,
        longitude: 77.5880,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-04-25"),
        verified: true,
        votes: 22,
        reportCount: 9,
        lastReportDate: new Date("2023-05-05"),
        category: "poorLighting",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Deserted Street Corner",
        description: "Isolated street corner with minimal traffic",
        latitude: 12.9670,
        longitude: 77.6130,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-04-28"),
        verified: true,
        votes: 11,
        reportCount: 4,
        lastReportDate: new Date("2023-05-08"),
        category: "isolation",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Bar Exit Area",
        description: "Area outside popular bar with reported harassment incidents",
        latitude: 12.9820,
        longitude: 77.6080,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-05-01"),
        verified: true,
        votes: 19,
        reportCount: 8,
        lastReportDate: new Date("2023-05-11"),
        category: "harassment",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Abandoned Building",
        description: "Partially demolished building with minimal security",
        latitude: 12.9580,
        longitude: 77.5990,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-03"),
        verified: true,
        votes: 14,
        reportCount: 5,
        lastReportDate: new Date("2023-05-13"),
        category: "isolation",
        timeOfDay: ["allDay"],
        isActive: true
      },
      {
        name: "Train Station Exit",
        description: "Poorly lit exit from train station with few pedestrians at night",
        latitude: 12.9780,
        longitude: 77.5680,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-05-05"),
        verified: true,
        votes: 27,
        reportCount: 10,
        lastReportDate: new Date("2023-05-15"),
        category: "assault",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Underpass",
        description: "Road underpass with limited visibility and foot traffic",
        latitude: 12.9710,
        longitude: 77.6200,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-08"),
        verified: true,
        votes: 16,
        reportCount: 6,
        lastReportDate: new Date("2023-05-18"),
        category: "poorLighting",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Bike Theft Hotspot",
        description: "Area with multiple reports of bicycle and motorcycle theft",
        latitude: 12.9640,
        longitude: 77.5920,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-05-10"),
        verified: true,
        votes: 8,
        reportCount: 3,
        lastReportDate: new Date("2023-05-20"),
        category: "theft",
        timeOfDay: ["allDay"],
        isActive: true
      },
      {
        name: "Isolated ATM",
        description: "ATM in secluded area with minimal security",
        latitude: 12.9690,
        longitude: 77.6070,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-12"),
        verified: true,
        votes: 13,
        reportCount: 5,
        lastReportDate: new Date("2023-05-22"),
        category: "theft",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "College Back Gate",
        description: "Secluded college exit with poor lighting",
        latitude: 12.9740,
        longitude: 77.5860,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-15"),
        verified: true,
        votes: 11,
        reportCount: 4,
        lastReportDate: new Date("2023-05-25"),
        category: "harassment",
        timeOfDay: ["evening"],
        isActive: true
      },
      {
        name: "Riverside Path",
        description: "Walking path along river with no lighting after dark",
        latitude: 12.9810,
        longitude: 77.5970,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-05-18"),
        verified: true,
        votes: 20,
        reportCount: 7,
        lastReportDate: new Date("2023-05-28"),
        category: "isolation",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Empty Lot",
        description: "Vacant land between buildings with reported incidents",
        latitude: 12.9620,
        longitude: 77.6020,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-05-20"),
        verified: true,
        votes: 7,
        reportCount: 2,
        lastReportDate: new Date("2023-05-30"),
        category: "other",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Taxi Stand Area",
        description: "Area with reported incidents of overcharging and harassment",
        latitude: 12.9760,
        longitude: 77.6040,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-05-22"),
        verified: true,
        votes: 9,
        reportCount: 3,
        lastReportDate: new Date("2023-06-01"),
        category: "harassment",
        timeOfDay: ["allDay"],
        isActive: true
      },
      {
        name: "Hospital Back Entrance",
        description: "Poorly monitored hospital entrance with few security cameras",
        latitude: 12.9680,
        longitude: 77.5870,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-05-25"),
        verified: true,
        votes: 5,
        reportCount: 2,
        lastReportDate: new Date("2023-06-04"),
        category: "isolation",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Bridge Crossing",
        description: "Narrow pedestrian bridge with poor visibility",
        latitude: 12.9790,
        longitude: 77.5930,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-28"),
        verified: true,
        votes: 12,
        reportCount: 5,
        lastReportDate: new Date("2023-06-07"),
        category: "poorLighting",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Residential Block Corner",
        description: "Corner of residential area with reported incidents",
        latitude: 12.9630,
        longitude: 77.6090,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-05-30"),
        verified: true,
        votes: 14,
        reportCount: 6,
        lastReportDate: new Date("2023-06-09"),
        category: "assault",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "School Perimeter Wall",
        description: "Area behind school with minimal monitoring",
        latitude: 12.9720,
        longitude: 77.6150,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-06-01"),
        verified: true,
        votes: 6,
        reportCount: 2,
        lastReportDate: new Date("2023-06-11"),
        category: "isolation",
        timeOfDay: ["evening"],
        isActive: true
      },
      {
        name: "Shopping Mall Back Entrance",
        description: "Service entrance area with poor lighting",
        latitude: 12.9770,
        longitude: 77.5850,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-06-03"),
        verified: true,
        votes: 10,
        reportCount: 4,
        lastReportDate: new Date("2023-06-13"),
        category: "theft",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Stadium Exit",
        description: "Crowded exit after events with reported incidents",
        latitude: 12.9710,
        longitude: 77.6010,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-06-05"),
        verified: true,
        votes: 13,
        reportCount: 5,
        lastReportDate: new Date("2023-06-15"),
        category: "theft",
        timeOfDay: ["evening"],
        isActive: true
      },
      {
        name: "Temple Alley",
        description: "Narrow alley leading to temple with poor lighting",
        latitude: 12.9655,
        longitude: 77.5945,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-06-08"),
        verified: true,
        votes: 7,
        reportCount: 2,
        lastReportDate: new Date("2023-06-18"),
        category: "poorLighting",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Library Parking",
        description: "Parking area behind library with minimal security",
        latitude: 12.9700,
        longitude: 77.6100,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-06-10"),
        verified: true,
        votes: 6,
        reportCount: 2,
        lastReportDate: new Date("2023-06-20"),
        category: "isolation",
        timeOfDay: ["evening", "night"],
        isActive: true
      },
      {
        name: "Industrial Zone Path",
        description: "Walking path through industrial area with minimal pedestrians",
        latitude: 12.9660,
        longitude: 77.5890,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-06-12"),
        verified: true,
        votes: 11,
        reportCount: 4,
        lastReportDate: new Date("2023-06-22"),
        category: "isolation",
        timeOfDay: ["allDay"],
        isActive: true
      },
      {
        name: "Hotel Back Entrance",
        description: "Service entrance of hotel with reported incidents",
        latitude: 12.9740,
        longitude: 77.6030,
        threatLevel: "medium",
        reportedBy: "system",
        reportedAt: new Date("2023-06-15"),
        verified: true,
        votes: 9,
        reportCount: 3,
        lastReportDate: new Date("2023-06-25"),
        category: "harassment",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Railway Crossing",
        description: "Isolated railway crossing with poor visibility",
        latitude: 12.9680,
        longitude: 77.5910,
        threatLevel: "high",
        reportedBy: "system",
        reportedAt: new Date("2023-06-18"),
        verified: true,
        votes: 17,
        reportCount: 7,
        lastReportDate: new Date("2023-06-28"),
        category: "assault",
        timeOfDay: ["night"],
        isActive: true
      },
      {
        name: "Office Complex Side Entrance",
        description: "Rarely used entrance to office complex",
        latitude: 12.9730,
        longitude: 77.5960,
        threatLevel: "low",
        reportedBy: "system",
        reportedAt: new Date("2023-06-20"),
        verified: true,
        votes: 5,
        reportCount: 2,
        lastReportDate: new Date("2023-06-30"),
        category: "isolation",
        timeOfDay: ["evening"],
        isActive: true
      }
    ];
    
    // Insert the threat locations
    const result = await collection.insertMany(threats);
    
    console.log(`${result.insertedCount} threat locations added`);
  } finally {
    await client.close();
    console.log("Connection closed");
  }
}

// Run the script
addMoreThreatLocations()
  .then(() => console.log("More threat locations added successfully"))
  .catch(console.error)
  .finally(() => process.exit()); 